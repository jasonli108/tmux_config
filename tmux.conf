##### SHELL + CLIPBOARD
set-option -g default-command /home/linuxbrew/.linuxbrew/bin/fish
set-option -g set-clipboard on

##### STATUS BAR
set-option -g status-bg colour235  # dark status bar without inactive highlight

##### MOUSE + HISTORY
set -g mouse on
set -g history-limit 10000

##### VI MODE
setw -g mode-keys vi

##### SPLIT PANE BINDINGS
bind | split-window -h -c "#{pane_current_path}"
bind _ split-window -v -c "#{pane_current_path}"
unbind '"'
unbind %

##### NEW SESSION IN CURRENT DIRECTORY
bind C new-session -c "#{pane_current_path}"

##### PLUGINS
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-battery'
set -g @plugin 'tmux-plugins/tmux-prefix-highlight'
set -g @plugin 'tmux-plugins/tmux-online-status'
set -g @plugin 'tmux-plugins/tmux-sidebar'
set -g @plugin 'tmux-plugins/tmux-copycat'
set -g @plugin 'tmux-plugins/tmux-open'
set -g @plugin 'samoshkin/tmux-plugin-sysstat'
set -g @plugin 'jimeh/tmux-themepack'
set -g @plugin 'tmux-plugins/tmux-resurrect'

run '~/.tmux/plugins/tpm/tpm'
run-shell "~/.tmux-themepack/powerline/default/grey.tmuxtheme"

##### CLEAN UNBINDS
unbind "\$" # rename-session
unbind ,    # rename-window
unbind [    # paste-buffer
unbind ]    
unbind "'"  # select-window
unbind n
unbind p
unbind l
unbind M-n
unbind M-p
unbind o
unbind &    
unbind "#"  # list-buffer 
unbind =    # choose-buffer
unbind M-Up
unbind M-Down
unbind M-Right
unbind M-Left
unbind C-r
unbind C-s   # free Ctrl-s for terminal

##### CONFIG EDIT/RELOAD
bind C-e new-window -n 'tmux.conf' "sh -c '\${EDITOR:-vim} ~/.tmux.conf && tmux source ~/.tmux.conf && tmux display-message \"Config reloaded\"'"
bind C-r source-file ~/.tmux.conf \; display-message "Config reloaded"
# new window and retain cwd
bind c new-window -c "#{pane_current_path}"

##### RENAME WINDOW/SESSION
set-hook -g after-new-window 'command-prompt -I "#{window_name}" "rename-window '%%'"'
bind r command-prompt -I "#{window_name}" "rename-window '%%'"
bind R command-prompt -I "#{session_name}" "rename-session '%%'"

##### SELECT PANES + WINDOWS
bind -r C-[ previous-window
bind -r C-] next-window
bind -r [ select-pane -t :.-
bind -r ] select-pane -t :.+
bind -r Tab last-window   # cycle thru MRU tabs
bind -r C-o swap-pane -D

##### ZOOM PANE
bind + resize-pane -Z

##### LINK WINDOW
bind L command-prompt -p "Link window from (session:window): " "link-window -s %% -a"

##### KILL SHORTCUTS
bind x kill-pane
bind X kill-window
bind C-x confirm-before -p "kill other windows? (y/n)" "kill-window -a"
bind Q confirm-before -p "kill-session #S? (y/n)" kill-session

##### MERGE SESSIONS
bind C-u command-prompt -p "Session to merge with: " \
    "run-shell 'yes | head -n #{session_windows} | xargs -I {} -n 1 tmux movew -t %%'"

##### DETACH
bind d detach
bind D if -F '#{session_many_attached}' \
    'confirm-before -p "Detach other clients? (y/n)" "detach -a"' \
    'display-message "Session has only 1 client attached"'

##### PANE MOVEMENT
bind-key j select-pane -D
bind-key h select-pane -L
bind-key k select-pane -U
bind-key l select-pane -R

##### COPY MODE
bind p copy-mode
bind-key -T copy-mode-vi y send -X copy-pipe-and-cancel "xclip -selection clipboard -in"

##### TOGGLE STATUS BAR
bind C-s if -F '#{s/off//:status}' 'set status off' 'set status on'

##### TMUX RESURRECT
bind S run-shell "~/.tmux/plugins/tmux-resurrect/scripts/save.sh" \; display-message "Resurrect saved"
bind R run-shell "~/.tmux/plugins/tmux-resurrect/scripts/restore.sh" \; display-message "Resurrect restored"

set -g @resurrect-save 'on'
set -g @resurrect-save-shell-history 'on'
set -g @resurrect-save-layouts 'on'
set -g @resurrect-processes ''

##### AUTOMATIC 3-PANE LAYOUT FOR NEW WINDOWS
# Left column fixed width: 28, bottom-left fixed height: 24
# set-hook -g after-new-window 'run-shell "tmux split-window -h -l 28 -c #{pane_current_path} && tmux split-window -v -l 24 -t 0 -c #{pane_current_path} && tmux select-pane -t 0 && tmux select-layout main-vertical"'

# Bind prefix + S to create a new window with a 3-pane layout
bind R new-window -c "#{pane_current_path}" \; \
    split-window -h -l 28 -c "#{pane_current_path}" \; \
    split-window -v -l 24 -t 0 -c "#{pane_current_path}" \; \
    select-pane -t 0 \; \
    select-layout main-vertical

bind L new-window -c "#{pane_current_path}" \; \
    split-window -h -c "#{pane_current_path}" \; \
    select-pane -L \; \
    split-window -v -l 24 -c "#{pane_current_path}" \; \
    select-pane -t 0

